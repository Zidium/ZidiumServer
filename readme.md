# Zidium
Open Source мониторинг приложений и информационных систем

## Требования
- Windows 7 и выше, Windows Server 2008 R2 и выше
- .Net Framework 4.6.1
- IIS 8
- MS Sql Server (в том числе Express) или PostgreSql
- Visual Studio версии 2017 CE (для самостоятельной сборки, необязательно)

## Установка на Windows
Серверная чать Zidium состоит из пяти приложений:
- Приложение для создания или обновления модели в базе данных (DatabasesUpdate)
- Web-сервис Диспетчера (DispatcherService)
- Web-сервис АПИ (ApiService)
- Личный кабинет (UserAccount)
- Агент для выполнения периодических действий (Agent)

### Скачайте релиз и разархивируйте его в папку
Или скачайте исходники и соберите релиз, выполнив файл BuildRelease.bat. Релиз будет в папке Release.

Для самостоятельной сборки нужна Visual Studio версии 2017 CE или выше.

Возможно, вам потребуется в BuildRelease.bat изменить путь к файлу msbuild.exe

### Создайте новую базу данных в вашей СУБД и обновите в ней модель данных
Для этого  в конфиге приложения DatabasesUpdate (DatabasesUpdate.exe.config) пропишите строку соединения с БД под названием DbContextWork.

В файле уже есть примеры строк соединения для MsSql и PostgreSql. Раскомментируйте нужную вам и поменяйте свойства.

Запустите DatabasesUpdate.exe и выберите вариант W (Work).

После обновления модели введите email и пароль, с которыми будет создан первый пользователь-администратор.

### Разверните в IIS приложение DispatcherService
Для этого создайте в IIS новый сайт, назовите его, например, Zidium.Dispatcher и укажите физическую папку DispatcherService.

Убедитесь, что будет создан новый пул приложений.

В привязке укажите свободный порт, например, 20000.

Снимите галочку "запустить сайт сейчас" и нажмите ОК.

Перейдите в список пулов приложений, для пула Zidium.Dispatcher поставьте в дополнительных настройках значение True для настройки "отключить перезапуск с перекрытием".

Откройте файл web.config и в укажите строку соединения с БД (как указывали в DatabasesUpdate.exe.config).

В настройке AccountSecretKey укажите секретный ключ, который будут использовать приложения для доступа.

Теперь запустите сайт в IIS.

Откройте в браузере https://127.0.0.1:20000/test , должен отображаться текст SUCCESS.

### Разверните в IIS приложение ApiService
Для этого создайте в IIS новый сайт, назовите его, например, Zidium.Api и укажите физическую папку ApiService.

Убедитесь, что будет создан новый пул приложений.

В привязке укажите свободный порт, например, 20001.

Снимите галочку "запустить сайт сейчас" и нажмите ОК.

Откройте файл web.config и в укажите строку соединения с БД (как указывали в DatabasesUpdate.exe.config).

В настройке DispatcherUrl укажите адрес приложения DispatcherService, например, https://127.0.0.1:20000.

В настройке AccountSecretKey укажите тот же секретный ключ, который указывали в конфигурации диспетчера.

Теперь запустите сайт в IIS.

Откройте в браузере https://127.0.0.1:20001/test , должен отображаться текст SUCCESS.

### Разверните в IIS личный кабинет
Для этого создайте в IIS новый сайт, назовите его, например, Zidium.UserAccount и укажите физическую папку UserAccount.

Убедитесь, что будет создан новый пул приложений.

В привязке укажите свободный порт, например, 20002.

Снимите галочку "запустить сайт сейчас" и нажмите ОК.

Откройте файл web.config и в укажите строку соединения с БД (как указывали в DatabasesUpdate.exe.config).

В настройке DispatcherUrl укажите адрес приложения DispatcherService, например, https://127.0.0.1:20000.

В настройке AccountSecretKey укажите тот же секретный ключ, который указывали в конфигурации диспетчера.

Теперь запустите сайт в IIS.

Откройте в браузере https://127.0.0.1:20002 , должена открыться страница для входа в систему.

### Разверните приложение-агент
Для этого в файле Zidium.Agent.exe.config укажите строку соединения с БД (как указывали в DatabasesUpdate.exe.config).

В настройке DispatcherUrl укажите адрес приложения DispatcherService, например, https://127.0.0.1:20000.

В настройке AccountWebSite укажите адрес сайта личного кабинета, например, https://127.0.0.1:20002.

В настройке AccountSecretKey укажите тот же секретный ключ, который указывали в конфигурации диспетчера.

Чтобы агент мог отправлять email'ы, в разделе smtp заполните параметры подключения к вашему smtp-серверу.

Чтобы агент мог отправлять sms, в разделе sms заполните параметры подключения к сервису sms.ru.

Запустите Zidium.Agent.exe, агент будет выводить свой лог в консольное окно. В дальнейшем агент можно установить как службу, запустив с ключом -install.

### Проверьте, как всё работает
Откройте в браузере личный кабинет и зайдите с логином и паролем, выбранными на первом шаге.

Перейдите в раздел "Компоненты", вы увидите дерево компонентов, все должны быть зелёными.

## Что ещё полезного можно сделать
На боевом сервере мы рекомендуем использовать open source приложение Zidium Server Monitor (https://github.com/Zidium/ServerMonitor) для мониторинга состояния самого сервера.

Чтобы Zidium Server Monitor обращался к вашему сервису Api, а не к облачному, в файле настроек Zidium.config в разделе access в атрибуте url укажите укажите адрес приложения ApiService, например, https://127.0.0.1:20001.
